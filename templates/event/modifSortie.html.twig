{% extends 'layout.html.twig' %}

{% block title %}{{ parent() }} | {{ title }}{% endblock %}

{% block main %}
    <div>
        <h3>Modifi√©e une sortie !</h3>
    </div>
    <div>
        {{ form_start(sortieForm) }}
        <div>
            {{ form_label(sortieForm.nom) }}
            {{ form_widget(sortieForm.nom) }}
            {{ form_errors(sortieForm.nom) }}
        </div>
        <div>
            {{ form_label(sortieForm.dateHeureDebut) }}
            {{ form_widget(sortieForm.dateHeureDebut) }}
            {{ form_errors(sortieForm.dateHeureDebut) }}
        </div>
        <div>
            {{ form_label(sortieForm.duree) }}
            {{ form_widget(sortieForm.duree) }}
            {{ form_errors(sortieForm.duree) }}
        </div>
        <div>
            {{ form_label(sortieForm.dateLimiteInscription) }}
            {{ form_widget(sortieForm.dateLimiteInscription) }}
            {{ form_errors(sortieForm.dateLimiteInscription) }}
        </div>
        <div>
            {{ form_label(sortieForm.nbInscriptionsMax) }}
            {{ form_widget(sortieForm.nbInscriptionsMax) }}
            {{ form_errors(sortieForm.nbInscriptionsMax) }}
        </div>
        <div>
            {{ form_label(sortieForm.infosSortie) }}
            {{ form_widget(sortieForm.infosSortie) }}
            {{ form_errors(sortieForm.infosSortie) }}
        </div>
        <div>
            {{ form_label(sortieForm.ville) }}
            {{ form_widget(sortieForm.ville) }}
            {{ form_errors(sortieForm.ville) }}
        </div>
        <div>
            {{ form_label(sortieForm.lieu) }}
            {{ form_widget(sortieForm.lieu) }}
            {{ form_errors(sortieForm.lieu) }}
        </div>
        <div>
            <p id="infoLieu"></p>
            <p id="infoLatitude"></p>
            <p id="infoLongitude"></p>
        </div>
        <div>
            <p id="infoVille"></p>
        </div>
        <div>
            <label>Site : </label>
            {{ app.user.site.nom }}
        </div>
        <div>
            {{ form_label(sortieForm.enregistrer) }}
            {{ form_widget(sortieForm.enregistrer) }}
            {{ form_label(sortieForm.publier) }}
            {{ form_widget(sortieForm.publier) }}
            {{ form_end(sortieForm) }}
            <a href="{{ path('list') }}" ><button type="button">Annuler</button></a>
        </div>
    </div>

    <script>
        $( document ).ready(function() {
            $('#sortie_ville').change();
        });

        $('#sortie_ville').change(function(e) {
            var choix = $(this).val();
            $.ajax({
                url: "{{ path('requeteAjax') }}",
                type: 'POST',
                dataType: 'json',
                data: { 'choix' : choix},
                async: true,
                success: function (data) {
                    $('#sortie_lieu').empty();
                    $.each(data, function (id, lieu) {
                        $('#sortie_lieu').append($('<option value="'+ id + '">' + lieu + '</option>'))
                    });
                    $('#sortie_lieu').change();
                }
            });
            e.preventDefault();
        });

    </script>

    <script>
        $('#sortie_lieu').change(function(e) {
            var detailLieu = $(this).val();
            $.ajax({
                url: "{{ path('requeteLieu') }}",
                type: 'POST',
                dataType: 'json',
                data: { 'detailLieu' : detailLieu},
                async: true,
                success: function (data) {
                    //console.log(data);
                    $('#infoLieu').text('Adresse : ' + data.rue);
                    $('#infoLatitude').text('Latitude : ' + data.longitude);
                    $('#infoLongitude').text('Longitude : ' + data.latitude);
                    $('#infoVille').text('Code Postal : ' + data.cp)
                }
            });
            e.preventDefault();
        });
    </script>
{% endblock %}

